<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kirubai Payanam - Tamil Lyrics</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Noto+Sans+Tamil:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- PDF & PPT Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>

    <style>
        /* --- RESET & VARIABLES --- */
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        :root {
            /* Theme Colors */
            --primary: #6c5ce7;
            --primary-light: #a29bfe;
            --bg: #f8f9fd;
            --surface: #ffffff;
            --text-main: #2d3436;
            --text-sub: #636e72;
            --border: #ececec;
            --shadow: 0 4px 20px rgba(0,0,0,0.05);
            
            /* DYNAMIC SETTINGS */
            --card-radius: 20px;
            --card-width: 280px;
            --cover-height: 180px;
            --shadow-opacity: 0.08;
            --title-size: 18px;
            --anim-speed: 20s;
            --global-font: 'Poppins', sans-serif;
            --ui-padding: 20px; /* Density Control */
            
            /* LIST & LETTER SETTINGS */
            --list-item-height: 80px;
            --letter-font-size: 16px;

            /* LYRICS PAGE VARIABLES */
            --l-font: 'Noto Sans Tamil', sans-serif;
            --l-size: 22px;
            --l-height: 2.2;
            --l-align: center; 
            --l-bg: #ffffff;
            --l-text: #2d3436;
            --l-max-width: 800px;
            --l-spacing: 0px;
            --l-transform: none;
        }

        [data-theme="dark"] {
            --bg: #121212;
            --surface: #1e1e1e;
            --text-main: #e0e0e0;
            --text-sub: #a0a0a0;
            --border: #333;
            --shadow: 0 4px 20px rgba(0,0,0,0.3);
            --l-bg: #1e1e1e;
            --l-text: #e0e0e0;
        }

        body {
            font-family: var(--global-font);
            margin: 0; padding: 0;
            background-color: var(--bg);
            color: var(--text-main);
            transition: 0.3s;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex; flex-direction: column;
            padding-bottom: 80px; /* Space for mobile nav */
        }

        /* --- BACKGROUND ANIMATION --- */
        .bg-anim { position: fixed; top:0; left:0; width:100%; height:100%; z-index:-1; overflow:hidden; }
        .blob { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.4; animation: float var(--anim-speed) infinite ease-in-out; }
        .blob:nth-child(1) { width: 400px; height: 400px; background: var(--primary); top: -100px; left: -100px; opacity: 0.15; }
        .blob:nth-child(2) { width: 300px; height: 300px; background: #00b894; bottom: -50px; right: -50px; opacity: 0.15; animation-delay: -5s; }
        @keyframes float { 0%,100%{transform:translate(0,0);} 50%{transform:translate(30px,-30px);} }
        body.no-anim .blob { display: none; }
        body.simple-bg { background: var(--bg); } 
        body.simple-bg .bg-anim { display: none; }

        /* --- HEADER (Desktop) --- */
        header {
            background: var(--surface); 
            padding: 20px 4%; /* Increased side padding */
            position: sticky; top: 0; z-index: 100;
            box-shadow: var(--shadow);
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(12px);
            margin-bottom: 20px;
        }

        .header-top { display: flex; justify-content: space-between; align-items: center; max-width: 1400px; margin: 0 auto; }
        
        .logo { display: flex; align-items: center; gap: 12px; font-weight: 800; font-size: 24px; color: var(--primary); letter-spacing: -0.5px; }
        .logo i { background: var(--primary); color: white; width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 18px; transform: rotate(-5deg); box-shadow: 0 4px 10px rgba(108, 92, 231, 0.4); }

        /* Desktop Nav */
        .desktop-nav { display: none; gap: 5px; background: var(--bg); padding: 5px; border-radius: 25px; border: 1px solid var(--border); }
        .v-btn { border: none; background: transparent; padding: 10px 18px; border-radius: 20px; cursor: pointer; color: var(--text-sub); transition: 0.2s; font-size: 14px; font-weight: 600; font-family: inherit; }
        .v-btn:hover { color: var(--primary); background: rgba(0,0,0,0.02); }
        .v-btn.active { background: var(--surface); color: var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        
        @media (min-width: 768px) { .desktop-nav { display: flex; } }

        /* Mobile Bottom Nav */
        .mobile-nav {
            display: flex; position: fixed; bottom: 0; left: 0; width: 100%;
            background: var(--surface); border-top: 1px solid var(--border);
            padding: 12px 20px; justify-content: space-around; z-index: 1000;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
            backdrop-filter: blur(10px);
        }
        @media (min-width: 768px) { .mobile-nav { display: none; } body { padding-bottom: 0; } }
        
        .m-nav-item {
            display: flex; flex-direction: column; align-items: center; gap: 5px;
            color: var(--text-sub); font-size: 11px; font-weight: 600; cursor: pointer;
            width: 65px; transition: 0.2s;
        }
        .m-nav-item i { font-size: 22px; margin-bottom: 2px; }
        .m-nav-item.active { color: var(--primary); transform: translateY(-3px); }

        /* Search & Filter Bar */
        .search-row { 
            max-width: 1400px; margin: 20px auto 0; display: flex; gap: 15px; align-items: center; 
        }
        .search-box {
            flex-grow: 1; display: flex; align-items: center; background: var(--bg);
            padding: 0 25px; border-radius: 35px; border: 1px solid var(--border);
            transition: 0.3s; box-shadow: inset 0 2px 5px rgba(0,0,0,0.02); height: 55px;
        }
        .search-box:focus-within { border-color: var(--primary); background: var(--surface); box-shadow: 0 6px 20px rgba(108, 92, 231, 0.15); }
        .search-box input {
            border: none; background: transparent; padding: 15px 10px; width: 100%;
            font-size: 16px; color: var(--text-main); font-family: inherit; height: 100%;
        }
        .settings-btn {
            width: 55px; height: 55px; border-radius: 50%; background: var(--surface);
            border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; 
            cursor: pointer; color: var(--text-main); transition: 0.2s; flex-shrink: 0; font-size: 22px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .settings-btn:hover { background: var(--primary); color: white; border-color: var(--primary); transform: rotate(90deg); }

        /* Categories */
        .cat-bar {
            display: flex; gap: 12px; overflow-x: auto; padding: 20px 0 5px;
            max-width: 1400px; margin: 0 auto; scrollbar-width: none;
        }
        .cat-chip {
            padding: 10px 24px; border-radius: 30px; background: var(--surface);
            border: 1px solid var(--border); color: var(--text-sub); cursor: pointer;
            font-size: 14px; white-space: nowrap; font-weight: 600; transition: 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        .cat-chip:hover { border-color: var(--primary); color: var(--primary); transform: translateY(-2px); }
        .cat-chip.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 6px 15px rgba(108, 92, 231, 0.3); }

        /* --- ADVANCED APP SETTINGS MODAL --- */
        #settings-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 2000; align-items: center; justify-content: center;
            backdrop-filter: blur(8px);
        }
        .settings-box {
            background: var(--surface); width: 95%; max-width: 500px; padding: 35px;
            border-radius: 28px; box-shadow: 0 30px 70px rgba(0,0,0,0.3);
            animation: popUp 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            max-height: 85vh; overflow-y: auto; position: relative;
        }
        @keyframes popUp { from{transform:scale(0.9) translateY(20px); opacity:0;} to{transform:scale(1) translateY(0); opacity:1;} }

        .s-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 2px solid var(--border); padding-bottom: 15px; }
        .s-title { font-size: 20px; font-weight: 800; color: var(--primary); }
        
        .s-section-title { 
            font-size: 12px; font-weight: 800; color: var(--text-sub); text-transform: uppercase; 
            margin: 25px 0 15px; letter-spacing: 1.5px; display: flex; align-items: center; gap: 10px;
        }
        .s-section-title::after { content: ''; flex: 1; height: 1px; background: var(--border); }
        
        .s-item { margin-bottom: 22px; }
        .s-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .s-label { font-size: 15px; font-weight: 600; display:flex; align-items:center; gap:8px; }
        .s-val { font-size: 13px; color: var(--primary); font-weight: 700; background: rgba(108, 92, 231, 0.1); padding: 3px 10px; border-radius: 8px; }
        
        input[type=range] { width: 100%; accent-color: var(--primary); height: 8px; background: #ddd; border-radius: 5px; -webkit-appearance: none; }
        input[type=range]::-webkit-slider-thumb { 
            -webkit-appearance: none; width: 22px; height: 22px; background: var(--surface); 
            border: 5px solid var(--primary); border-radius: 50%; cursor: pointer; 
            box-shadow: 0 3px 8px rgba(0,0,0,0.2); transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.1); }

        .toggle { position: relative; width: 50px; height: 28px; }
        .toggle input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .3s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 22px; width: 22px; left: 3px; bottom: 3px; background-color: white; transition: .3s; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(22px); }

        .theme-row { display: flex; gap: 15px; justify-content: space-between; }
        .theme-circle { width: 45px; height: 45px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; transition: 0.2s; position: relative; }
        .theme-circle.active { transform: scale(1.15); border-color: var(--text-main); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }

        .view-settings { display: none; animation: fadeIn 0.3s; }
        .view-settings.active { display: block; }
        @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }

        /* --- CONTENT VIEWS --- */
        #main-container { flex: 1; padding: 20px 4%; max-width: 1400px; margin: 0 auto; width: 100%; }

        /* 1. LETTER VIEW (Default) */
        .letter-group { margin-bottom: 35px; }
        .letter-head { 
            font-size: 24px; font-weight: 800; color: var(--primary); 
            border-bottom: 3px solid var(--bg); margin-bottom: 18px; padding-bottom: 5px; 
            display: inline-block; padding-right: 30px;
        }
        .letter-items { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 15px; }
        .l-item {
            background: var(--surface); padding: 20px 25px; border-radius: 16px;
            border: 1px solid var(--border); cursor: pointer; display: flex; justify-content: space-between; align-items: center; 
            transition: all 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        }
        .l-item:hover { border-left: 6px solid var(--primary); transform: translateX(8px); box-shadow: 0 10px 25px rgba(0,0,0,0.08); }
        .l-text { font-size: var(--letter-font-size); font-weight: 600; color: var(--text-main); }
        .l-singer { font-size: 12px; color: var(--text-sub); background: var(--bg); padding: 5px 12px; border-radius: 12px; font-weight: 500; }

        /* 2. GRID VIEW */
        .grid-layout { 
            display: grid; gap: 30px; 
            grid-template-columns: repeat(auto-fill, minmax(var(--card-width), 1fr)); 
        }
        
        .card {
            background: var(--surface); border-radius: var(--card-radius);
            overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,var(--shadow-opacity));
            cursor: pointer; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            display: flex; flex-direction: column; border: 1px solid rgba(0,0,0,0.03);
            height: 100%; position: relative;
        }
        .card:hover { transform: translateY(-10px); box-shadow: 0 25px 50px rgba(0,0,0,0.15); border-color: rgba(108, 92, 231, 0.2); }

        .card-cover {
            height: var(--cover-height); display: flex; align-items: center; justify-content: center;
            padding: 25px; color: white; text-align: center; position: relative;
            background-size: 200% 200%; animation: grad 8s infinite;
        }
        @keyframes grad { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
        
        .card-cover-text {
            font-family: 'Noto Sans Tamil', sans-serif; font-size: 16px; font-weight: 600;
            line-height: 1.6; text-shadow: 0 3px 6px rgba(0,0,0,0.3);
            display: -webkit-box; -webkit-line-clamp: 5; -webkit-box-orient: vertical; overflow: hidden;
            font-style: italic; letter-spacing: 0.5px;
        }

        .card-body { padding: 22px; display: flex; flex-direction: column; gap: 10px; flex-grow: 1; }
        .card-title { font-size: var(--title-size); font-weight: 700; line-height: 1.4; color: var(--text-main); }
        .card-sub { font-size: 13px; color: var(--text-sub); display: flex; align-items: center; gap: 6px; font-weight: 500; }
        
        .card-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-top: auto; padding-top: 15px; border-top: 1px dashed var(--border); }
        .c-tag { font-size: 11px; background: var(--bg); color: var(--text-sub); padding: 5px 12px; border-radius: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }

        /* 3. LIST VIEW */
        .list-layout { 
            display: grid; gap: 15px;
            grid-template-columns: 1fr;
        }
        @media (min-width: 768px) { .list-layout { grid-template-columns: repeat(2, 1fr); } }
        @media (min-width: 1200px) { .list-layout { grid-template-columns: repeat(3, 1fr); } }

        .list-mode .card { flex-direction: row; height: var(--list-item-height); align-items: center; border-radius: 16px; }
        .list-mode .card-cover { width: var(--list-item-height); height: 100%; padding: 5px; flex-shrink: 0; border-radius: 0; }
        .list-mode .card-cover-text { font-size: 10px; line-height: 1.3; -webkit-line-clamp: 3; }
        .list-mode .card-body { padding: 0 20px; justify-content: center; border-left: 1px solid var(--border); }
        .list-mode .card-tags { display: none; }

        /* --- LYRICS PAGE --- */
        #lyrics-view {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--l-bg); color: var(--l-text);
            z-index: 2000; display: none; flex-direction: column; overflow-y: auto;
            animation: slideIn 0.4s cubic-bezier(0.19, 1, 0.22, 1);
        }
        @keyframes slideIn { from{transform:translateY(100%);} to{transform:translateY(0);} }

        .lv-header {
            position: sticky; top: 0; background: var(--l-bg); padding: 15px 4%;
            display: flex; align-items: center; justify-content: space-between;
            border-bottom: 1px solid rgba(0,0,0,0.05); z-index: 10;
            transition: background 0.3s;
        }
        .lv-btn {
            width: 45px; height: 45px; border-radius: 50%; background: rgba(0,0,0,0.05);
            border: none; cursor: pointer; color: var(--l-text); font-size: 18px;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .lv-btn:hover { background: var(--primary); color: white; }

        /* Animated Download Buttons */
        .dl-container {
            display: flex; gap: 15px; justify-content: center; padding: 30px;
            flex-wrap: wrap; background: rgba(0,0,0,0.02);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .dl-chip {
            padding: 12px 24px; border-radius: 30px; font-size: 14px; font-weight: 700;
            color: white; border: none; cursor: pointer; display: flex; align-items: center; gap: 10px;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; overflow: hidden;
        }
        .dl-chip:hover { transform: translateY(-4px); box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .dl-chip::after { content:''; position:absolute; top:0; left:-100%; width:100%; height:100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); transition:0.5s; }
        .dl-chip:hover::after { left:100%; }
        
        .ppt-c { background: linear-gradient(135deg, #e67e22, #f39c12); }
        .pdf-c { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .html-c { background: linear-gradient(135deg, #3498db, #2980b9); }

        .lv-content {
            padding: 50px 25px; max-width: 900px; margin: 0 auto;
            font-family: var(--l-font); font-size: var(--l-size); line-height: var(--l-height);
            text-align: var(--l-align); white-space: pre-wrap; transition: all 0.3s;
            letter-spacing: var(--l-spacing); text-transform: var(--l-transform);
        }

        /* Improved Lyrics Settings Popup (Glassmorphism) */
        #ls-panel {
            display: none; position: absolute; top: 80px; right: 20px; width: 340px;
            background: rgba(255, 255, 255, 0.95); color: #333; padding: 25px;
            border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); z-index: 20;
            animation: fadeIn 0.2s; border: 1px solid rgba(0,0,0,0.1);
            backdrop-filter: blur(15px);
        }
        [data-theme="dark"] #ls-panel { background: rgba(30, 30, 30, 0.95); color: #fff; border: 1px solid #444; }
        
        .ls-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 18px; }
        .ls-label { font-size: 11px; font-weight: 800; opacity: 0.7; text-transform: uppercase; letter-spacing: 0.5px; }
        .ls-grp { display: flex; gap: 5px; background: rgba(0,0,0,0.05); padding: 4px; border-radius: 12px; flex-grow: 1; margin-left: 10px; }
        .ls-b { flex: 1; padding: 8px; border: none; background: transparent; cursor: pointer; color: inherit; border-radius: 8px; font-size: 14px; font-weight: 600; transition: 0.2s; }
        .ls-b:hover { background: rgba(0,0,0,0.05); }
        .ls-b.active { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

        /* Carousel Related Songs */
        .rel-sec { background: rgba(0,0,0,0.03); padding: 60px 4%; border-top: 1px solid var(--border); }
        .rel-title { font-size: 22px; font-weight: 800; color: var(--primary); margin-bottom: 30px; border-left: 6px solid var(--primary); padding-left: 20px; }
        
        .carousel-wrap { overflow: hidden; width: 100%; position: relative; padding: 10px 0; }
        .carousel-track { display: flex; gap: 20px; animation: scrollLeft 60s linear infinite; width: max-content; }
        .carousel-track:hover { animation-play-state: paused; }
        @keyframes scrollLeft { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        
        .rel-card {
            min-width: 240px; width: 240px; background: var(--card-bg); 
            border-radius: 20px; overflow: hidden; box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            cursor: pointer; transition: 0.3s; border: 1px solid var(--border);
            display: flex; flex-direction: column;
        }
        .rel-card:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 15px 35px rgba(0,0,0,0.15); border-color: var(--primary); }
        .rel-cover { height: 140px; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; text-align: center; padding: 15px; background-size: 200%; animation: grad 8s infinite; }
        .rel-info { padding: 15px; }
        .rel-t { font-size: 15px; font-weight: 700; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--text-main); }
        .rel-s { font-size: 12px; color: var(--text-sub); }

    </style>
</head>
<body>

    <div class="bg-anim"><div class="blob"></div><div class="blob"></div></div>

    <header>
        <div class="header-top">
            <div class="logo"><i class="fas fa-music"></i> Kirubai Payanam</div>
            
            <div class="desktop-nav">
                <button class="v-btn active" id="btn-letter" onclick="setView('letter')"><i class="fas fa-font"></i> A-Z</button>
                <button class="v-btn" id="btn-grid" onclick="setView('grid')"><i class="fas fa-th-large"></i> Grid</button>
                <button class="v-btn" id="btn-list" onclick="setView('list')"><i class="fas fa-list"></i> List</button>
            </div>
        </div>
        
        <div class="search-row">
            <div class="search-box">
                <i class="fas fa-search" style="color:#aaa;"></i>
                <input type="text" id="inp-search" placeholder="Search song lyrics (e.g. Aatma)..." onkeyup="filterSongs()">
            </div>
            <button class="settings-btn" onclick="openSettings()"><i class="fas fa-sliders-h"></i></button>
        </div>

        <div class="cat-bar">
            <button class="cat-chip active" onclick="filterCat('All', this)">All Songs</button>
            <button class="cat-chip" onclick="filterCat('Worship', this)">Worship</button>
            <button class="cat-chip" onclick="filterCat('Traditional', this)">Traditional</button>
            <button class="cat-chip" onclick="filterCat('Praise', this)">Praise</button>
            <button class="cat-chip" onclick="filterCat('Comfort', this)">Comfort</button>
            <button class="cat-chip" onclick="filterCat('Christmas', this)">Christmas</button>
        </div>
    </header>

    <div id="container"></div>

    <!-- Mobile Bottom Navigation -->
    <div class="mobile-nav">
        <div class="m-nav-item active" onclick="setView('letter'); updateMobileNav(this)"><i class="fas fa-font"></i> A-Z</div>
        <div class="m-nav-item" onclick="setView('grid'); updateMobileNav(this)"><i class="fas fa-th-large"></i> Grid</div>
        <div class="m-nav-item" onclick="setView('list'); updateMobileNav(this)"><i class="fas fa-list"></i> List</div>
        <div class="m-nav-item" onclick="openSettings()"><i class="fas fa-cog"></i> Settings</div>
    </div>

    <!-- ADVANCED APP SETTINGS MODAL -->
    <div id="settings-modal" onclick="if(event.target==this)closeSettings()">
        <div class="settings-box">
            <div class="s-header">
                <span class="s-title">App Customization</span>
                <i class="fas fa-times" onclick="closeSettings()" style="cursor:pointer; font-size:20px;"></i>
            </div>
            
            <div class="s-section-title"><i class="fas fa-eye"></i> Appearance</div>
            
            <div class="s-item">
                <div class="s-row"><span class="s-label">UI Density</span></div>
                <div class="ls-grp">
                    <button class="ls-b active" onclick="setDensity('comfortable', this)">Comfortable</button>
                    <button class="ls-b" onclick="setDensity('compact', this)">Compact</button>
                </div>
            </div>

            <div class="s-item">
                <div class="s-row"><span class="s-label">Font Family</span></div>
                <div class="ls-grp">
                    <button class="ls-b active" onclick="setGlobalFont('Poppins', this)">Poppins</button>
                    <button class="ls-b" onclick="setGlobalFont('sans-serif', this)">System</button>
                </div>
            </div>

            <div class="s-item">
                <div class="s-row"><span class="s-label">Background Style</span></div>
                <div class="ls-grp">
                    <button class="ls-b active" onclick="setBg('blobs', this)">Blobs</button>
                    <button class="ls-b" onclick="setBg('simple', this)">Simple</button>
                </div>
            </div>

            <!-- View Specifics -->
            <div id="set-grid" class="view-settings">
                <div class="s-section-title"><i class="fas fa-th-large"></i> Grid Options</div>
                <div class="s-item"><div class="s-row"><span class="s-label">Card Width</span> <span class="s-val" id="disp-w">280px</span></div><input type="range" min="150" max="400" value="280" oninput="upCSS('--card-width', this.value+'px', 'disp-w')"></div>
                <div class="s-item"><div class="s-row"><span class="s-label">Cover Height</span> <span class="s-val" id="disp-h">180px</span></div><input type="range" min="100" max="300" value="180" oninput="upCSS('--cover-height', this.value+'px', 'disp-h')"></div>
                <div class="s-item"><div class="s-row"><span class="s-label">Roundness</span> <span class="s-val" id="disp-r">20px</span></div><input type="range" min="0" max="40" value="20" oninput="upCSS('--card-radius', this.value+'px', 'disp-r')"></div>
            </div>

            <div id="set-list" class="view-settings">
                <div class="s-section-title"><i class="fas fa-list"></i> List Options</div>
                <div class="s-item"><div class="s-row"><span class="s-label">Row Height</span> <span class="s-val" id="disp-lh">80px</span></div><input type="range" min="60" max="140" value="80" oninput="upCSS('--list-item-height', this.value+'px', 'disp-lh')"></div>
            </div>

            <div id="set-letter" class="view-settings active">
                <div class="s-section-title"><i class="fas fa-font"></i> List Options</div>
                <div class="s-item"><div class="s-row"><span class="s-label">Font Size</span> <span class="s-val" id="disp-fs">16px</span></div><input type="range" min="12" max="24" value="16" oninput="upCSS('--letter-font-size', this.value+'px', 'disp-fs')"></div>
            </div>

            <div class="s-section-title"><i class="fas fa-sliders-h"></i> Theme</div>
            <div class="s-item">
                <div class="theme-row">
                    <div class="theme-circle active" style="background:#6c5ce7;" onclick="setTheme('#6c5ce7', this)"></div>
                    <div class="theme-circle" style="background:#00b894;" onclick="setTheme('#00b894', this)"></div>
                    <div class="theme-circle" style="background:#ff7675;" onclick="setTheme('#ff7675', this)"></div>
                    <div class="theme-circle" style="background:#0984e3;" onclick="setTheme('#0984e3', this)"></div>
                    <div class="theme-circle" style="background:#e84393;" onclick="setTheme('#e84393', this)"></div>
                </div>
            </div>
            <div class="s-item">
                <div class="s-row">
                    <span class="s-label">Dark Mode</span>
                    <div class="toggle"><input type="checkbox" onchange="toggleDark(this.checked)"><span class="slider"></span></div>
                </div>
            </div>
            
            <button class="reset-btn" onclick="location.reload()"><i class="fas fa-undo"></i> Reset All Settings</button>
        </div>
    </div>

    <!-- LYRICS PAGE -->
    <div id="lyrics-view">
        <div class="lv-header">
            <button class="lv-btn" onclick="closeLyrics()"><i class="fas fa-arrow-left"></i></button>
            <div style="text-align:center;">
                <div id="lv-title" style="font-weight:800; font-size:16px;">Title</div>
                <div id="lv-singer" style="font-size:12px; opacity:0.7;">Singer</div>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="lv-btn" onclick="copyL()" title="Copy Text"><i class="fas fa-copy"></i></button>
                <button class="lv-btn customize-btn" onclick="toggleLS()" title="Lyrics Settings"><i class="fas fa-font"></i></button>
            </div>
        </div>

        <div class="dl-container">
            <button class="dl-chip ppt-c" onclick="dlPPT()"><i class="fas fa-file-powerpoint"></i> PPT</button>
            <button class="dl-chip pdf-c" onclick="dlPDF()"><i class="fas fa-file-pdf"></i> PDF</button>
            <button class="dl-chip html-c" onclick="dlHTML()"><i class="fas fa-code"></i> HTML</button>
        </div>

        <!-- Advanced Lyrics Settings Popup -->
        <div id="ls-panel">
            <div class="ls-row">
                <span class="ls-label">Size</span>
                <div class="ls-grp"><button class="ls-b" onclick="adjL('sz', -2)">-</button><button class="ls-b" onclick="adjL('sz', 2)">+</button></div>
            </div>
            <div class="ls-row">
                <span class="ls-label">Spacing</span>
                <div class="ls-grp"><button class="ls-b" onclick="adjL('sp', -1)">-</button><button class="ls-b" onclick="adjL('sp', 1)">+</button></div>
            </div>
            <div class="ls-row">
                <span class="ls-label">Style</span> 
                <div class="ls-grp">
                    <button class="ls-b" onclick="adjL('tr', 'uppercase')">AA</button>
                    <button class="ls-b active" onclick="adjL('tr', 'none')">Aa</button>
                </div>
            </div>
            <div class="ls-row">
                <span class="ls-label">Align</span> 
                <div class="ls-grp">
                    <button class="ls-b" onclick="adjL('al', 'left')"><i class="fas fa-align-left"></i></button>
                    <button class="ls-b active" onclick="adjL('al', 'center')"><i class="fas fa-align-center"></i></button>
                </div>
            </div>
            <div class="ls-row">
                <span class="ls-label">Theme</span> 
                <div class="ls-grp">
                    <button class="ls-b" onclick="adjL('bg', 'light')">Light</button>
                    <button class="ls-b" onclick="adjL('bg', 'sepia')">Sepia</button>
                    <button class="ls-b" onclick="adjL('bg', 'dark')">Dark</button>
                </div>
            </div>
        </div>

        <div id="lv-text" class="lv-content"></div>

        <div class="rel-sec">
            <div class="rel-title">You Might Also Like</div>
            <div class="carousel-wrap">
                <div id="rel-track" class="carousel-track"></div>
            </div>
        </div>
    </div>

    <!-- DATABASE -->
    <div id="db" style="display:none;">
        <div class="s" data-t="ஆத்துமாவே நன்றி" data-tn="Aathmaave Nandri" data-s="Fr. Berchmans" data-c="Worship">ஆத்துமாவே நன்றி சொல்லு...</div>
        <div class="s" data-t="உம்மை அல்லாமல்" data-tn="Ummai Allamal" data-s="Gersson" data-c="Worship">உம்மை அல்லாமல் எனக்கு...</div>
        <div class="s" data-t="என்னப்பா அல்லவா" data-tn="Ennappa Allava" data-s="Traditional" data-c="Traditional">என்னப்பா அல்லவா...</div>
        <div class="s" data-t="கிருபையினால்" data-tn="Kirubaiyinaal" data-s="Traditional" data-c="Traditional">கிருபையினால் நிலைநிற்கின்றோம்...</div>
        <div class="s" data-t="ஆராதனை ஆராதனை" data-tn="Aaradhana" data-s="Worship" data-c="Worship">ஆராதனை ஆராதனை...</div>
        <div class="s" data-t="ஆனந்தமாக அன்பரை" data-tn="Anandhamaga" data-s="Worship" data-c="Praise">ஆனந்தமாக அன்பரை...</div>
        <div class="s" data-t="காவல் ஓபரே" data-tn="Kaaval Obarae" data-s="Traditional" data-c="Traditional">காவல் ஓபரே தருவேன்...</div>
        <div class="s" data-t="இயேசு என்னும் நாமம்" data-tn="Yesu Ennum" data-s="Unknown" data-c="Praise">இயேசு என்னும் நாமம்...</div>
        <div class="s" data-t="துதித்து பாடிட" data-tn="Thuthithu Paadida" data-s="Worship" data-c="Praise">துதித்து பாடிட பாத்திரம்...</div>
        <div class="s" data-t="உயர் மலையோ" data-tn="Uyar Malaiyo" data-s="Comfort" data-c="Comfort">உயர் மலையோ ஆழ கடலோ...</div>
        <div class="s" data-t="ஆட்கொண்ட தெய்வம்" data-tn="Aatkonnda Deivam" data-s="Comfort" data-c="Comfort">ஆட்கொண்ட தெய்வம்...</div>
        <div class="s" data-t="ஆ! அம்பர உம்பர" data-tn="Aa Ambara" data-s="Christmas" data-c="Christmas">ஆ! அம்பர உம்பர...</div>
        <!-- Duplicates for Carousel Demo -->
        <div class="s" data-t="நீரே என் தஞ்சம்" data-tn="Neerae En Thanjam" data-s="Artist" data-c="Worship">நீரே என் தஞ்சம்...</div>
        <div class="s" data-t="எல்லாம் இயேசுவே" data-tn="Ellam Yesuvae" data-s="Artist" data-c="Praise">எல்லாம் இயேசுவே...</div>
        <div class="s" data-t="ஸ்தோத்திரம் இயேசுவே" data-tn="Sthothiram" data-s="Artist" data-c="Worship">ஸ்தோத்திரம் இயேசுவே...</div>
    </div>

    <script>
        let songs = [];
        let view = 'letter'; // Default View: LETTER
        let cat = 'All';
        const grads = [ "linear-gradient(135deg, #6c5ce7, #a29bfe)", "linear-gradient(135deg, #00b894, #55efc4)", "linear-gradient(135deg, #e17055, #fab1a0)", "linear-gradient(135deg, #0984e3, #74b9ff)", "linear-gradient(135deg, #fd79a8, #e84393)" ];

        function init() {
            document.querySelectorAll('.s').forEach((el, i) => {
                songs.push({
                    id: i, t: el.dataset.t, tn: el.dataset.tn, s: el.dataset.s, c: el.dataset.c, l: el.innerHTML, bg: grads[i % grads.length]
                });
            });
            render();
        }

        function setView(v) {
            view = v;
            document.querySelectorAll('.v-btn').forEach(b => b.classList.remove('active'));
            if(document.getElementById('btn-'+v)) document.getElementById('btn-'+v).classList.add('active');
            render();
            document.querySelectorAll('.view-settings').forEach(e=>e.classList.remove('active'));
            if(v==='grid' || v==='list' || v==='letter') document.getElementById('set-'+v).classList.add('active');
        }

        function updateMobileNav(el) {
            document.querySelectorAll('.m-nav-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
        }

        function filterCat(c, btn) {
            cat = c;
            document.querySelectorAll('.cat-chip').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            render();
        }

        function lev(a, b) {
            if(a.length==0) return b.length; if(b.length==0) return a.length;
            var m = []; for(var i=0;i<=b.length;i++) m[i]=[i]; for(var j=0;j<=a.length;j++) m[0][j]=j;
            for(var i=1;i<=b.length;i++) for(var j=1;j<=a.length;j++) {
                m[i][j] = b.charAt(i-1)==a.charAt(j-1) ? m[i-1][j-1] : Math.min(m[i-1][j-1]+1, Math.min(m[i][j-1]+1, m[i-1][j]+1));
            } return m[b.length][a.length];
        }

        function filterSongs() { render(); }

        function render() {
            const q = document.getElementById('inp-search').value.toLowerCase();
            const con = document.getElementById('container');
            con.className = view === 'grid' ? 'grid-layout' : (view === 'list' ? 'list-layout list-mode' : 'letter-list');
            con.innerHTML = '';

            let filtered = songs.filter(s => {
                if(cat !== 'All' && s.c !== cat) return false;
                if(q) {
                    if(s.t.toLowerCase().includes(q) || s.tn.toLowerCase().includes(q) || s.l.toLowerCase().includes(q)) return true;
                    let words = s.tn.toLowerCase().split(' ');
                    for(let w of words) if(lev(q, w) <= 2) return true;
                    return false;
                }
                return true;
            });

            if(filtered.length === 0) { con.innerHTML = '<p style="width:100%; text-align:center; padding:30px; opacity:0.6;">No songs found.</p>'; return; }

            if(view === 'letter') {
                let grouped = {};
                filtered.forEach(s => { let l = s.t.charAt(0); if(!grouped[l]) grouped[l]=[]; grouped[l].push(s); });
                Object.keys(grouped).sort().forEach(l => {
                    let sec = document.createElement('div'); sec.className = 'letter-group';
                    sec.innerHTML = `<div class="letter-head">${l}</div>`;
                    let div = document.createElement('div'); div.className = 'letter-items';
                    grouped[l].forEach(s => {
                        let it = document.createElement('div'); it.className = 'l-item';
                        it.onclick = () => openL(s.id);
                        it.innerHTML = `<span class="l-text">${s.t}</span><span class="l-singer">${s.s}</span>`;
                        div.appendChild(it);
                    });
                    sec.appendChild(div); con.appendChild(sec);
                });
                return;
            }

            filtered.forEach(s => {
                let d = document.createElement('div'); d.className = 'card';
                d.onclick = () => openL(s.id);
                d.innerHTML = `
                    <div class="card-cover" style="background:${s.bg}"><div class="card-cover-text">${s.l}</div></div>
                    <div class="card-body">
                        <div class="song-title">${s.t}</div>
                        <div class="song-singer"><i class="fas fa-microphone"></i> ${s.s}</div>
                        <div class="card-tags"><span class="c-tag">${s.c}</span></div>
                    </div>
                `;
                con.appendChild(d);
            });
        }

        /* --- LYRICS LOGIC --- */
        function openL(id) {
            const s = songs.find(x => x.id === id);
            document.getElementById('lv-title').innerText = s.t;
            document.getElementById('lv-singer').innerText = s.s;
            document.getElementById('lv-text').innerText = s.l;
            
            // Carousel Related Songs
            const track = document.getElementById('rel-track'); track.innerHTML = '';
            // Clone list to make it seamless
            let rel = songs.filter(x => x.id !== id).concat(songs.filter(x => x.id !== id));
            
            rel.forEach(r => {
                let rc = document.createElement('div'); rc.className = 'rel-card';
                rc.onclick = () => { openL(r.id); document.getElementById('lyrics-view').scrollTop = 0; };
                rc.innerHTML = `<div class="rel-cover" style="background:${r.bg}">${r.l.substring(0,30)}...</div>
                <div class="rel-info"><div class="rel-t">${r.t}</div><div class="rel-s">${r.s}</div></div>`;
                track.appendChild(rc);
            });

            document.getElementById('lyrics-view').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeLyrics() { 
            document.getElementById('lyrics-view').style.display = 'none'; 
            document.body.style.overflow = 'auto'; 
            document.getElementById('ls-panel').style.display = 'none';
        }

        function copyL() {
            const t = document.getElementById('lv-text').innerText;
            const ta = document.createElement('textarea'); ta.value = t; document.body.appendChild(ta); ta.select();
            try { document.execCommand('copy'); alert('Copied!'); } catch(e){} document.body.removeChild(ta);
        }

        /* --- BEAUTIFUL PPT GENERATION --- */
        function dlPPT() {
            const t = document.getElementById('lv-title').innerText;
            const s = document.getElementById('lv-singer').innerText;
            const l = document.getElementById('lv-text').innerText;
            
            let pptx = new PptxGenJS(); 
            pptx.layout = 'LAYOUT_16x9';
            
            // Master Slide
            pptx.defineSlideMaster({
                title: "MASTER",
                background: { color: "FFFFFF" },
                objects: [
                    { rect: { x: 0, y: 0, w: "100%", h: 1.5, fill: { type: "gradient", color: ["6C5CE7", "a29bfe"] } } },
                    { text: { text: "Kirubai Payanam", options: { x: 0.5, y: 0.4, w: 5, h: 0.5, color: "FFFFFF", fontSize: 20, bold:true, fontFace:'Arial' } } },
                    { line: { x: 0, y: 7, w: "100%", h: 0, line: { color: "6C5CE7", width: 5 } } },
                    { text: { text: "Generated by Kirubai Payanam App", options: { x: 0.5, y: 7.1, w: "90%", fontSize: 10, color: "888888" } } }
                ]
            });

            // 1. Title Slide
            let s1 = pptx.addSlide({masterName:"MASTER"});
            s1.addText(t, { x:1, y:2.5, w:'80%', fontSize:60, align:'center', color:'2D3436', bold:true, fontFace:'Arial' });
            s1.addText(s, { x:1, y:4.5, w:'80%', fontSize:32, align:'center', color:'636E72', italic:true });

            // 2. Lyrics Slides
            let lines = l.split('\n').filter(x => x.trim());
            for(let i=0; i<lines.length; i+=5) {
                let slide = pptx.addSlide({masterName:"MASTER"});
                
                // Mini Header
                slide.addText(t, { x:0.5, y:0.5, w:'85%', fontSize:14, color:'FFFFFF', bold:true, align:'right' });
                
                // Lyrics Content (Styled Box)
                let txt = lines.slice(i, i+5).join('\n');
                slide.addText(txt, { 
                    x:1, y:2, w:'80%', h:'60%', 
                    fontSize:40, align:'center', color:'333333', 
                    valign:'middle', lineSpacing:48, fontFace:'Arial',
                    shadow: {type:'outer', color:'cccccc', blur:3, offset:2}
                });
            }
            pptx.writeFile({fileName: t+".pptx"});
        }

        function dlPDF() {
            const t = document.getElementById('lv-title').innerText;
            const s = document.getElementById('lv-singer').innerText;
            const l = document.getElementById('lv-text').innerText;
            
            const element = document.createElement('div');
            element.style.cssText = "padding: 40px; font-family: 'Helvetica', sans-serif; color: #333; text-align: center; border: 10px solid #6c5ce7; height: 100%; background: #fff;";
            element.innerHTML = `
                <h1 style="color:#6c5ce7; font-size:30px; margin-bottom:10px;">${t}</h1>
                <div style="color:#666; font-style:italic; margin-bottom:40px;">${s}</div>
                <div style="font-size:16px; line-height:2; white-space: pre-wrap;">${l}</div>
                <div style="margin-top:50px; color:#ccc; font-size:12px;">Generated by Kirubai Payanam App</div>
            `;
            
            var opt = {
                margin: 0.5,
                filename: t + '.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
            };
            
            html2pdf().set(opt).from(element).save();
        }

        function dlHTML() {
            const t = document.getElementById('lv-title').innerText;
            const s = document.getElementById('lv-singer').innerText;
            const l = document.getElementById('lv-text').innerText.replace(/\n/g, "<br>");
            
            const htmlContent = `
            <html>
            <head>
                <title>${t}</title>
                <style>
                    body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); margin: 0; padding: 40px; min-height: 100vh; display: flex; justify-content: center; align-items: center; }
                    .card { background: white; padding: 50px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 700px; width: 100%; text-align: center; }
                    h1 { color: #6c5ce7; margin-bottom: 10px; }
                    .singer { color: #888; font-style: italic; margin-bottom: 30px; }
                    p { font-size: 18px; line-height: 2; color: #333; }
                </style>
            </head>
            <body>
                <div class="card">
                    <h1>${t}</h1>
                    <div class="singer">${s}</div>
                    <p>${l}</p>
                </div>
            </body>
            </html>`;
            
            const blob = new Blob([htmlContent], { type: "text/html" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = t + ".html";
            link.click();
        }

        /* --- SETTINGS --- */
        function openSettings() { 
            document.getElementById('settings-modal').style.display = 'flex';
            document.querySelectorAll('.view-settings').forEach(e=>e.classList.remove('active'));
            if(view === 'grid') document.getElementById('set-grid').classList.add('active');
            else if(view === 'list') document.getElementById('set-list').classList.add('active');
            else if(view === 'letter') document.getElementById('set-letter').classList.add('active');
        }
        function closeSettings() { document.getElementById('settings-modal').style.display = 'none'; }
        
        function upCSS(v, val, id) { document.documentElement.style.setProperty(v, val); if(id) document.getElementById(id).innerText = val; }
        function setTheme(c, el) { document.documentElement.style.setProperty('--primary', c); document.querySelectorAll('.theme-circle').forEach(e=>e.classList.remove('active')); el.classList.add('active'); }
        function toggleDark(v) { if(v) document.body.setAttribute('data-theme', 'dark'); else document.body.removeAttribute('data-theme'); }
        function setDensity(v, el) { 
            // Mock function for demo
            document.querySelectorAll('.ls-b').forEach(b => b.classList.remove('active')); el.classList.add('active');
        }
        function setGlobalFont(f, el) {
            document.body.style.fontFamily = f + ', sans-serif';
        }
        function setBg(v, el) {
            if(v==='simple') document.body.classList.add('simple-bg'); else document.body.classList.remove('simple-bg');
        }

        function toggleLS() {
            const p = document.getElementById('ls-panel'); const b = document.querySelector('.customize-btn');
            if(p.style.display==='block') { p.style.display='none'; b.classList.remove('active'); } else { p.style.display='block'; b.classList.add('active'); }
        }

        let ls = {sz:20, sp:0};
        function adjL(t, v) {
            const r = document.documentElement;
            if(t==='sz') { ls.sz+=v; if(ls.sz<14)ls.sz=14; r.style.setProperty('--l-size', ls.sz+'px'); }
            if(t==='sp') { ls.sp+=v; r.style.setProperty('--l-spacing', ls.sp+'px'); }
            if(t==='al') { r.style.setProperty('--l-align', v); }
            if(t==='tr') { r.style.setProperty('--l-transform', v); }
            if(t==='bg') {
                if(v==='light') { r.style.setProperty('--l-bg', '#fff'); r.style.setProperty('--l-text', '#2d3436'); }
                if(v==='sepia') { r.style.setProperty('--l-bg', '#f4ecd8'); r.style.setProperty('--l-text', '#5b4636'); }
                if(v==='dark') { r.style.setProperty('--l-bg', '#1e1e1e'); r.style.setProperty('--l-text', '#e0e0e0'); }
            }
        }

        init();
    </script>
</body>
</html>
